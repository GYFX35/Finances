{% extends "base.html" %}

{% block title %}{{ thread.title if thread else 'Thread Not Found' }} - Marketing Forum{% endblock %}

{% block content %}
    {% if thread %}
        <h1>{{ thread.title }}</h1>
        <p><strong>By:</strong> {{ thread.author_name }} | <strong>On:</strong> {{ thread.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
        <div>
            {{ thread.initial_post_content|safe }} {# Assuming content might have basic HTML; use with caution or add sanitization later #}
        </div>
        <hr>

        <h2>Replies ({{ thread.replies|length }})</h2>
        {% if thread.replies %}
            <ul>
                {% for reply in thread.replies|sort(attribute='replied_at') %} {# Sort replies by time ascending #}
                    <li>
                        <p><strong>{{ reply.reply_author_name }}</strong> ({{ reply.replied_at.strftime('%Y-%m-%d %H:%M') }}):</p>
                        <div>{{ reply.reply_content|safe }}</div>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No replies yet. Be the first to reply!</p>
        {% endif %}

        <hr>
        <h3>Leave a Reply</h3>
        <form method="POST" action="{{ url_for('add_marketing_reply', thread_id=thread_id) }}">
            <div>
                <label for="reply_author_name">Your Name:</label>
                <input type="text" id="reply_author_name" name="reply_author_name" required>
            </div>
            <div>
                <label for="reply_content">Your Reply:</label>
                <textarea id="reply_content" name="reply_content" rows="4" required></textarea>
            </div>
            <div>
                <button type="submit">Post Reply</button>
            </div>
        </form>

    {% else %}
        <h1>Thread Not Found</h1>
        <p>The discussion thread you are looking for does not exist.</p>
    {% endif %}
    <p><a href="{{ url_for('view_marketing_forum') }}">Back to Marketing Forum</a></p>
{% endblock %}

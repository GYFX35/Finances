{% extends "base.html" %}

{% block title %}
    {{ news_item.title[:50] if news_item else 'News Not Found' }} - News Details
{% endblock %}

{% block content %}
    {% if news_item %}
        <h1>{{ news_item.title }}</h1>
        <p>
            <strong>Source:</strong> {{ news_item.source_name }}
            {% if news_item.publication_date_str and news_item.publication_date_str != 'N/A' %}
                | <strong>Published:</strong> {{ news_item.publication_date_str }}
            {% endif %}
        </p>
        <p><small>Shared on this platform: {{ news_item.date_posted_on_site.strftime('%Y-%m-%d %H:%M') }}</small></p>

        {% if news_item.link_to_article %}
            <p><strong>Original Article:</strong> <a href="{{ news_item.link_to_article }}" target="_blank">{{ news_item.link_to_article }}</a></p>
        {% endif %}

        <h2>Summary/Content</h2>
        <article>
            {{ news_item.summary|replace('\n', '<br>')|safe }} {# Render newlines and allow basic HTML if any #}
        </article>

        <hr>
        <h2>Comments</h2>
        {% if news_item.comments %}
            <ul>
                {% for comment in news_item.comments|sort(attribute='timestamp') %}
                    <li>
                        <p><strong>{{ comment.author_name }}</strong> ({{ comment.timestamp.strftime('%Y-%m-%d %H:%M') }}):</p>
                        <div>{{ comment.text|replace('\n', '<br>')|safe }}</div>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No comments yet. Be the first to share your thoughts!</p>
        {% endif %}

        <hr>
        <h3>Leave a Comment</h3>
        <form method="POST" action="{{ url_for('add_news_comment', news_id=news_id) }}">
            <div>
                <label for="author_name">Your Name:</label>
                <input type="text" id="author_name" name="author_name" required>
            </div>
            <div>
                <label for="comment_text">Comment:</label>
                <textarea id="comment_text" name="comment_text" rows="3" required></textarea>
            </div>
            <div>
                <button type="submit">Submit Comment</button>
            </div>
        </form>

    {% else %}
        <h1>News Item Not Found</h1>
        <p>The news item you are looking for does not exist.</p>
    {% endif %}
    <p><a href="{{ url_for('view_news_list') }}">Back to News List</a></p>
{% endblock %}
